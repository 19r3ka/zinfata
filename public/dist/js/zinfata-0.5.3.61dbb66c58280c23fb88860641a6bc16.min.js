function FileDataObject(e){var t=new FormData;return angular.forEach(e,function(e,a){t.append(a,e)}),t}var app=angular.module("zinfataClient",["ngRoute","ngResource","ngMessages","ngImgCrop"]);app.constant("ROUTES",{loginEndpoint:"zinfataclient",serverHost:"XXXXX"}).constant("AUTH",{loginSuccess:"auth-login-success",loginFailed:"auth-login-failed",mustLogIn:"auth-log-in-first",logoutSuccess:"auth-logout-success",logoutFailed:"auth-logout-failed",sessionTimeout:"auth-session-timeout",authenticated:"auth-authenticated",notAuthenticated:"auth-not-authenticated",authorized:"auth-authorized",notAuthorized:"auth-not-authorized"}).constant("USER_ROLES",{admin:"admin",artist:"artist",guest:"guest"}).constant("PWD_TOKEN",{sendSuccess:"token-sent-success",sendFailed:"token-sent-failed",verificationSuccess:"token-verification-success",verificationFailed:"token-verification-failed"}).constant("USER_EVENTS",{updateSuccess:"user-update-success",updateFailed:"user-update-failed",createSuccess:"user-creation-success",createFailed:"user-creation-failed",accountActivated:"user-account-activated",accountNotActivated:"user-account-not-activated",deleteSuccess:"user-delete-success",deleteFailed:"user-delete-failed"}).constant("ALBUM_EVENTS",{createSuccess:"album-creation-success",createFailed:"album-creation-failed",updateSuccess:"album-update-success",updateFailed:"album-update-failed",deleteSuccess:"album-delete-success",deleteFailed:"album-delete-failed"}).constant("TRACK_EVENTS",{updateSuccess:"track-update-success",updateFailed:"track-update-failed",createSuccess:"track-creation-success",createFailed:"track-creation-failed",deleteSuccess:"track-delete-success",deleteFailed:"track-delete-failed",downloadSuccess:"track-download-success",downloadFailed:"track-download-failed"}).constant("PLAYLIST_EVENTS",{updateSuccess:"playlist-update-success",updateFailed:"playlist-update-failed",createSuccess:"playlist-creation-success",createFailed:"playlist-creation-failed",deleteSuccess:"playlist-delete-success",deleteFailed:"playlist-delete-failed"}).constant("QUEUE",{next:"queue-next-track",prev:"queue-previous-track"}).constant("AUDIO",{load:"audio-load",playNow:"audio-playNow",playPause:"audio-play-pause",playing:"audio-playing",paused:"audio-paused",ended:"audio-ended"}),app.directive("uniqueHandle",["Users","$q","$log","$filter",function(e,t,a,n){return{require:"ngModel",link:function(a,r,o,s){var c=[],u="";e.query(function(e){for(i=0;i<e.length;i++)u=n("lowercase")(e[i].handle),c.push(u);s.$asyncValidators.uniquehandle=function(e,a){var r=t.defer(),i=n("lowercase")(e);return-1===c.indexOf(i)?r.resolve():r.reject(),r.promise}})}}}]).directive("uniqueEmail",["Users","$q","$log","$filter",function(e,t,a,n){return{require:"ngModel",link:function(a,r,o,s){var c=[];e.query(function(e){for(i=0;i<e.length;i++)c.push(n("lowercase")(e[i].email));s.$asyncValidators.uniqueemail=function(e,a){var r=t.defer(),i=n("lowercase")(e);return-1===c.indexOf(i)?r.resolve():r.reject(),r.promise}})}}}]).directive("zMatch",function(){return{require:"ngModel",scope:{firstPassword:"=zMatch"},link:function(e,t,a,n){n.$validators.pwmatch=function(t,a){return t===e.firstPassword}}}}).directive("zCapitalized",["$parse",function(e){return{require:"ngModel",link:function(t,a,n,r){function i(e){void 0===e&&(e="");var t=e.charAt(0).toUpperCase()+e.substring(1);return t!==e&&(r.$setViewValue(t),r.$render()),t}r.$parsers.push(i),i(e(n.ngModel)(t))}}}]).directive("zDropdown",["$document","$window",function(e,t){return{restrict:"A",link:function(a,n,r){var i=e.getElementByClassName("z-dropdown-menu");a.toggleContent=function(){i.classList.toggle("z-show")},t.onclick=function(e){e.target.matches("z-dropdown-toggle")||i.classList.contains("z-show")&&i.classList.remove("z-show")}}}}]).directive("zPlayer",["$rootScope","QueueSvc","QUEUE","AUDIO","$log","AuthenticationSvc","AUTH","MessageSvc","$window",function(e,t,a,n,r,i,o,s,c){return{restrict:"E",link:function(e,a){function r(e,t){return e/t*100}function s(){return b&&b.muted}function c(t,a){p();var n="sound_"+t._id;e.track=t;var i=soundManager.getSoundById(n);return i?(e.sound.loading=!1,c.stop(),a&&this.play()):i=soundManager.createSound({id:n,url:t.url,multiShot:!1,stream:!0,onload:function(){this.stop(),e.sound.loading=!1,e.sound.duration=k(this.duration),a&&this.play(),e.$apply()},whileplaying:function(){e.sound.position=k(this.position),e.sound.progress=r(this.position,this.duration),e.$apply()},whileloading:function(){e.sound.duration=k(this.durationEstimate),e.$apply()},onplay:function(){d()},onfinish:l,onresume:d,onpause:h,onstop:h}).load(),i}function u(){b&&b.toggleMute()}function l(){t.playNext()}function d(){e.isPlaying=!0}function f(){b&&b.togglePause()}function g(){t.playPrev()}function p(){var t=e.sound;t.duration=t.position=t.progress=0,e.sound.loading=!0}function m(){e.isLoggedIn()&&y()?a.show():a.hide()}function h(){e.isPlaying=!1}function v(){var e=angular.element(a[0].getElementsByClassName("z-collapsable")),t=angular.element(a[0].getElementsByClassName("toggle-button")[0]);t.hasClass("z-hiding")?e.show():e.hide(),t.toggleClass("z-hiding")}function k(e){return e/1e3}function y(){return!angular.equals({},e.track)}e.sound={duration:0,loading:!1,position:0,progress:0},e.isLoggedIn=i.isAuthenticated,e.isMuted=s,e.isPlaying=!1,e.muteToggle=u,e.next=l,e.playPause=f,e.prev=g,e.toggleVisibility=v,b=c(t.getCurrentTrack(),!1),e.$on(n.playPause,function(){f()}),e.$on(o.notAuthenticated,function(){elem.hide()}),e.$on(n.playNow,function(e,t){soundManager.stopAll(),b=c(t,!0),m()}),e.$on(n.load,function(e,t){soundManager.stopAll(),b=c(t,!1),m()}),e.$on(o.loginSuccess,function(e){m()}),e.$on(o.logoutSuccess,function(e){soundManager.stopAll(),m()}),m();var b;soundManager.setup({url:"/lib/sound-manager-2/swf/",flashVersion:9}),soundManager.onready(function(){}),soundManager.ontimeout(function(){})},templateUrl:"/templates/zPlayer"}}]).directive("zAlbumListing",["AlbumsSvc","TracksSvc","SessionSvc","$log",function(e,t,a,n){return{restrict:"E",scope:{artist:"="},link:function(n,r,i){n.isOwner=!1,n.albums=[],n.queueUp=function(e){},n.$watch(function(){return n.artist._id},function(r){void 0!==r&&(e.getByUser({_id:r},function(e){angular.forEach(e,function(e){e.img="/assets/albums/"+e._id+"/tof",e.duration=0,e.trackLength=0,t.find({a_id:e._id},function(t){angular.forEach(t,function(t){e.trackLength++,duration=parseInt(t.duration),e.duration+=duration})},function(e){}),this.push(e)},n.albums)},function(e){}),a.getCurrentUser()&&r===a.getCurrentUser()._id&&(n.isOwner=!0))})},templateUrl:"/templates/zAlbumListing"}}]).directive("zTrackListing",["TracksSvc","SessionSvc","QueueSvc","$log",function(e,t,a,n){return{restrict:"E",scope:{"for":"="},link:function(n,r,i){n.isOwner=!1,n.tracks=[],n.playlists=[],n.$watch(function(){return n["for"]._id},function(a){if(void 0!==a){var r=n["for"],o="album"===i.type?"a_id":"p_id",s="album"===i.type?r.artist.id:r.owner.id,c={};c[o]=r._id,e.find(c,function(e){angular.forEach(e,function(e){e.img="/assets/tracks/"+e._id+"/tof",this.push(e)},n.tracks)},function(e){}),t.getCurrentUser()&&t.getCurrentUser()._id===s&&(n.isOwner=!0)}}),n.play=function(e){a.playNow(e)},n.addToQueue=function(e){a.addTrack(e)}},templateUrl:"/templates/zTrackListing"}}]).directive("zDetailedTrackListing",["PlaylistsSvc","QueueSvc","$log",function(e,t,a){return{restrict:"E",scope:{tracks:"=",remove:"&onRemove"},link:function(e,a,n){e.play=function(e){t.playNow(e)},e.addToQueue=function(e){t.addTrack(e)}},templateUrl:"/templates/zDetailedTrackListing"}}]).directive("zSearchBox",["$http",function(e){return{restrict:"E",link:function(t,a,n,r){function i(e){if(s.length)for(var t=0;t<s.length;t++){if(s[t]===e||0===e.search(s[t]))return!1;if(0===s[t].search(e))return s[t]=e,!0}return s.push(e),!0}t.search={searchTerm:""};var o="api/search",s=[],c={params:{q:t.search.searchTerm},cache:!0};t.goFetch=function(a){a&&i(a)&&(c.params.q=a,e.get(o,c).then(function(e){if(t.search=e.data,t.search.users.length){var a=[];angular.forEach(t.search.users,function(e){e.img="/assets/users/"+e._id+"/tof",this.push(e)},a),t.search.users=a}if(t.search.albums.length){var n=[];angular.forEach(t.search.albums,function(e){e.img="/assets/albums/"+e._id+"/tof",this.push(e)},n),t.search.albums=n}if(t.search.tracks.length){var r=[];angular.forEach(t.search.tracks,function(e){e.img="/assets/tracks/"+e._id+"/tof",this.push(e)},r),t.search.tracks=r}}))}},templateUrl:"/templates/zSearchBox"}}]).directive("zPlaylistDropdown",["$rootScope","PlaylistsSvc","PLAYLIST_EVENTS","AUTH","AuthenticationSvc","SessionSvc","MessageSvc","$log",function(e,t,a,n,r,i,o,s){return{restrict:"E",scope:{track:"="},link:function(s,c,u){function l(){return d?void t.find({u_id:d._id},function(e){s.playlists=e},function(e){}):void(s.playlists=[])}c.addClass("z-dropdown-menu");var d=i.getCurrentUser();s.playlists=[],s.playlist={title:"",owner:{id:""}},s.loggedIn=r.isAuthenticated(),u.track&&(s.adding=!0),s.$watch(function(){return r.isAuthenticated()},function(e,t){e!==t&&(e&&(d=i.getCurrentUser()),l())}),s.$on(a.updateSuccess,function(){l()}),s.$on(a.createSuccess,function(){l()}),s.$on(a.deleteSuccess,function(){l()}),s.$on(n.loginSuccess,function(){l()}),s.loggedIn&&l(),s.create=function(n){n.owner.id=d._id,t.create(n,function(t){e.$broadcast(a.createSuccess,t),s.playlist.title=""},function(t){e.$broadcast(a.createFailed)})},s.addToPlaylist=function(e,a,n){s.adding&&(e.preventDefault(),t.addTrack(a,n,function(){o.addMsg("success",n.title+" added to "+a.title)},function(){o.addMsg("danger","Something went wrong adding track to playlist!")}))}},templateUrl:"/templates/zPlaylistDropdown"}}]).directive("zImgCrop",function(){return{restrict:"E",scope:{onImgReady:"&"},link:function(e){e.rawImage=e.croppedImage="",e.cropPending=!1,e.readFile=function(t){var a=t.files[0],n=new FileReader;n.onload=function(){e.$apply(function(){e.rawImage=n.result,e.cropPending=!0})},n.readAsDataURL(a)},e.updateAvatar=function(a){var n={file:t(a),url:a};return e.cropPending=!1,e.onImgReady({imgFile:n})};var t=function(e){for(var t=atob(e.split(",")[1]),a=e.split(",")[0].split(":")[1].split(";")[0],n=[],r=0;r<t.length;r++)n.push(t.charCodeAt(r));return new Blob([new Uint8Array(n)],{type:a})}},templateUrl:"/templates/zImgCrop"}}).directive("zMessageBox",["$rootScope","MessageSvc","$timeout",function(e,t,a){return{restrict:"E",link:function(e,a,n){e.$watch(function(){return t.getMsg()},function(t,n){t&&(e.message=t,a.show(),e.icon="success"===e.message.type?"fa fa-check":"fa fa-exclamation",timeout(function(){a.hide()},5e3))})},templateUrl:"/template/zMessageBox"}}]).directive("datepicker",[function(){return{restrict:"A",require:"ngModel",link:function(e,t,a,n){function r(t){e.$apply(function(){n.$setViewValue(t)})}var i={dateFormat:"yy-mm-dd",onSelect:function(e){r(e)}};Modernizr.inputtypes.date||t.datepicker(i)}}}]).directive("zCollapse",["$document",function(e){return{restrict:"A",link:function(e,t){t.on("click","a",function(){t.collapse("hide")})}}}]).directive("zAlbumCreator",["$rootScope","$document","AlbumsSvc","SessionSvc","ALBUM_EVENTS",function(e,t,a,n,r){return{restrict:"E",scope:{album:"="},link:function(t,i,o){t.save=function(t){t.artistId||(t.artist={},t.artist.id=n.getCurrentUser()._id),t.releaseDate=new Date,a.create(t,function(t){e.$broadcast(r.createSuccess,t)},function(t){e.$broadcast(r.createFailed)})}},templateUrl:"/templates/zAlbumCreator"}}]),app.factory("Users",["$resource",function(e){return e("/api/users/:id",{id:"@_id"},{update:{method:"PUT",transformRequest:FileDataObject,headers:{"Content-Type":void 0,enctype:"multipart/form-data"}},find:{method:"GET",url:"api/users/handle/:handle",params:{handle:"@handle"},isArray:!1},resetPassword:{method:"GET",url:"api/users/tokenize/:action/:email",params:{email:"@email",action:"pwd-reset"}},activate:{method:"GET",url:"api/users/tokenize/:action/:email",params:{email:"@email",action:"usr_activation"}},verifyToken:{method:"GET",url:"api/users/validate-token/:token",params:{token:"@token"}}})}]).factory("Albums",["$resource",function(e){return e("/api/albums/:id",{id:"@_id"},{update:{method:"PUT",transformRequest:FileDataObject,headers:{"Content-Type":void 0,enctype:"multipart/form-data"}},save:{method:"POST",transformRequest:FileDataObject,headers:{"Content-Type":void 0,enctype:"multipart/form-data"}},getByUser:{method:"GET",url:"/api/albums/user/:userId",params:{userId:"@_id"},isArray:!0}})}]).factory("Playlists",["$resource",function(e){return e("/api/playlists/:id",{id:"@_id"},{update:{method:"PUT"},find:{method:"GET",isArray:!0,url:"/api/playlists/:resource/:resource_id",params:{resource:"@resource",resource_id:"@resource_id"}}})}]).factory("Tracks",["$resource",function(e){return e("/api/tracks/:id",{id:"@_id"},{update:{method:"PUT",transformRequest:FileDataObject,headers:{"Content-Type":void 0,enctype:"multipart/form-data"}},save:{method:"POST",transformRequest:FileDataObject,headers:{"Content-Type":void 0,enctype:"multipart/form-data"}},find:{method:"GET",isArray:!0,url:"/api/tracks/:resource/:resource_id",params:{resource:"@resource",resource_id:"@resoureceId"}},download:{method:"GET",url:"/api/tracks/:id/download",params:{id:"@_id"}}})}]).factory("AccessToken",["$resource",function(e){return e("/zinfataclient/:resource",{resource:"@resource"},{getUser:{method:"GET",params:{resource:"me"}},getFor:{method:"POST"},revoke:{method:"POST",params:{resource:"revoke"}},refresh:{method:"POST",params:{resource:"refresh"}}})}]).factory("localStore",["$window","$rootScope","$log",function(e,t,a){return angular.element(e).on("storage",function(e){t.$apply()}),{setData:function(t,a){return e.localStorage.setItem(t,angular.toJson(a)),this},getData:function(t){var a=e.localStorage&&e.localStorage.getItem(t);return angular.fromJson(a)},deleteData:function(t){return e.localStorage&&e.localStorage.removeItem(t)}}}]).factory("sessionStore",["$window","$rootScope","$log",function(e,t,a){return{setData:function(t,a){return e.sessionStorage.setItem(t,angular.toJson(a)),this},getData:function(t){var a=e.sessionStorage&&e.sessionStorage.getItem(t);return angular.fromJson(a)},deleteData:function(t){return e.sessionStorage&&e.sessionStorage.removeItem(t)}}}]).factory("APIInterceptor",["$rootScope","$q","$location","$log","sessionStore","$httpParamSerializer","$injector",function(e,t,a,n,r,i,o){return{request:function(e){var t=r.getData("accessKeys"),a=t?t.access_token:null;return a&&(e.headers.authorization="Bearer "+a),-1!==e.url.search("zinfataclient")&&(e.headers["Content-Type"]="application/x-www-form-urlencoded",e.data=i(e.data)),e},responseError:function(e){if(401===e.status&&e.data.error&&"invalid_token"===e.data.error){var n=t.defer(),i=o.get("$http"),s=r.getData("accessKeys"),c=s?s.refresh_token:null,u={method:"POST",url:"/zinfataclient/refresh",data:{refresh_token:c}};return i(u).then(function(t){r.setData("accessKeys",t.data),i(e.config).then(function(e){n.resolve(e)},function(e){n.reject()})},function(e){n.reject(),r.deleteData("accessKeys"),r.deleteData("currentUser"),a.path("login")}),n.promise}return t.reject(e)}}}]),app.filter("duration2time",function(){return function(e){e=parseInt(e),angular.isNumber(e)||(e=0);var t="0"+Math.floor(e/60),a="0"+Math.floor(e)%60;return t.substr(-2)+":"+a.substr(-2)}}),app.config(["$routeProvider","$locationProvider","$httpProvider",function(e,t,a){e.when("/",{templateUrl:"/partials/dashboard",controller:"dashboardCtrl"}).when("/register",{templateUrl:"/partials/registration",controller:"registerCtrl"}).when("/register/activate",{templateUrl:"/partials/tokenValidator",controller:"tokenCtrl"}).when("/login",{templateUrl:"/partials/login",controller:"loginCtrl"}).when("/forgot",{templateUrl:"/partials/forgot",controller:"forgotCtrl"}).when("/reset",{templateUrl:"/partials/passwordReset",controller:"passwordResetCtrl"}).when("/user/:userId",{templateUrl:"/partials/userProfile",controller:"userProfileCtrl",access:{loginRequired:!0}}).when("/user/:userId/edit",{templateUrl:"/partials/userProfile",controller:"userProfileCtrl",access:{loginRequired:!0}}).when("/album/new",{templateUrl:"/partials/album",controller:"albumCtrl",access:{loginRequired:!0}}).when("/album/:albumId",{templateUrl:"/partials/album",controller:"albumCtrl",access:{loginRequired:!0}}).when("/album/:albumId/edit",{templateUrl:"/partials/album",controller:"albumCtrl",access:{loginRequired:!0}}).when("/track/new",{templateUrl:"/partials/track",controller:"trackCtrl",access:{loginRequired:!0}}).when("/track/:trackId",{templateUrl:"/partials/track",controller:"trackCtrl",access:{loginRequired:!0}}).when("/track/:trackId/edit",{templateUrl:"/partials/track",controller:"trackCtrl",access:{loginRequired:!0}}).when("/playlist/new",{templateUrl:"/partials/playlist",controller:"playlistCtrl",access:{loginRequired:!0}}).when("/playlist/:playlistId",{templateUrl:"/partials/playlist",controller:"playlistCtrl",access:{loginRequired:!0}}).when("/playlist/:playlistId/edit",{templateUrl:"/partials/playlist",controller:"playlistCtrl",access:{loginRequired:!0}}).when("/queue",{templateUrl:"/partials/queue",controller:"queueCtrl",access:{loginRequired:!0}}).when("/search",{templateUrl:"/partials/search",controller:"searchCtrl",access:{loginRequired:!0}}).otherwise({redirectTo:"/"}),t.html5Mode(!0),a.interceptors.push("APIInterceptor")}]).run(["$rootScope","$location","$log","AuthenticationSvc","AUTH","MessageSvc","UsersSvc",function(e,t,a,n,r,i,o){var s;e.$on("$routeChangeStart",function(a,o){var c;"/register"===o.originalPath?s=null:s&&"/login"!==o.originalPath&&(t.path(s).replace(),s=null),o.access&&(c=n.authorize(o.access.loginRequired),c===r.mustLogIn?(s=t.url(),i.addMsg("warning","You must log-in first to access that resource."),e.$broadcast(r.notAuthenticated),t.path("login")):c===r.notAuthorized)})}]),app.service("SessionSvc",["$rootScope","AUTH","UsersSvc","sessionStore",function(e,t,a,n){var r=this,i=null;e.$on(t.loginSuccess,function(e,t){r.setCurrentUser(t)}),e.$on(t.logoutSuccess,function(){r.destroy()}),r.setCurrentUser=function(e){n.setData("currentUser",e)},r.getCurrentUser=function(){return i=n.getData("currentUser")},r.destroy=function(){r.currentUser=null,n.deleteData("currentUser"),n.deleteData("accessKeys")}}]),app.service("AuthenticationSvc",["$rootScope","AUTH","ROUTES","SessionSvc","sessionStore","AccessToken","$log",function(e,t,a,n,r,i,o){var s=this;s.login=function(a,o,s){i.getFor({username:a.handle,password:a.password},function(a){e.$broadcast(t.authenticated),i.getUser({token:a.access_token},function(i){i.activated?(n.setCurrentUser(i),r.setData("accessKeys",a),e.$broadcast(t.loginSuccess,i),o(i)):(e.$broadcast(t.mustActivateAccount,i),s("mustActivateAccount"))},function(a){e.$broadcast(t.loginFailed),s(a)})},function(a){e.$broadcast(t.notAuthenticated),s(a)})},s.logout=function(e){var t=r.getData("accessKeys"),a=t?t.refresh_token:null;i.revoke({token_type_hint:"refresh_token",token:a},function(){n.destroy(),e(!0)},function(t){"invalid token"===t.error_description&&(n.destroy(),e(!0))}),e(!1)},s.isAuthenticated=function(){return n.getCurrentUser()&&n.getCurrentUser()._id?(e.$broadcast(t.authenticated),!0):(e.$broadcast(t.notAuthenticated),!1)},s.authorize=function(e){var a=t.authorized,n=s.isAuthenticated();return e&&!n&&(a=t.mustLogIn),a}}]),app.service("UsersSvc",["Users","MessageSvc","$log","$location","$rootScope",function(e,t,a,n,r){var i=this;i.create=function(t,a,n){var r=new e;for(var i in t)r[i]=t[i];r.$save(function(e){a(e)},function(e){n(e)})},i["delete"]=function(t,a,n){e["delete"]({id:t._id},function(e){return a(e)},function(e){return n(e)})},i.update=function(t,n,r){e.get({id:t._id},function(e){for(var i in e)t[i]&&e[i]!==t[i]&&(e[i]=t[i]);t.avatar&&(e.avatar=t.avatar),t.facebook&&(e.facebook=t.facebook),t.bio&&(e.bio=t.bio),t.twitter&&(e.twitter=t.twitter),t.website&&(e.website=t.website),e.$update(function(e){return n(e)},function(e){return a.error("Profile update failed: "+e),r(e)})})},i.get=function(t,a,n){e.get({id:t},function(e){e.img="/assets/users/"+e._id+"/tof",a(e)},function(e){n(e)})},i.all=e.query(function(e){return e},function(e){a.debug("Unable to get all the users!")}),i.findByHandle=function(t,a,n){return e.find({handle:t},function(e){e.img="/assets/users/"+e._id+"/tof",a(e)},function(e){n(e)})}}]),app.service("AlbumsSvc",["Albums","$log",function(e,t){var a=this;a.create=function(t,a,n){var r=new e({about:t.about,artistId:t.artist.id,coverArt:t.coverArt,releaseDate:t.releaseDate,title:t.title});r.$save(function(e){a(e)},function(e){n(e)})},a.update=function(t,a,n){e.get({id:t._id},function(e){for(var r in e)t[r]&&e[r]!==t[r]&&(e[r]=t[r]);t.coverArt&&(e.coverArt=t.coverArt),e.$update(function(e){a(e)},function(e){n(e)})})},a.get=function(t,a,n){e.get({id:t},function(e){e.artist={id:e.artistId},delete e.artistId,e.releaseDate=new Date(e.releaseDate),e.img="/assets/albums/"+e._id+"/tof",a(e)},function(e){n(e)})},a.all=e.query(function(e){var t=[];return angular.forEach(e,function(e){e.artist={id:e.artistId},delete e.artistId,e.releaseDate=new Date(e.releaseDate),e.img="/assets/albums/"+e._id+"/tof",this.push(e)},t),t},function(e){t.debug("Unable to get all the albums!")}),a.getByUser=function(t,a,n){e.getByUser({userId:t._id},function(e){angular.forEach(e,function(e){e.artist={id:e.artistId},delete e.artistId,e.releaseDate=new Date(e.releaseDate),e.img="/assets/albums/"+e._id+"/tof"}),a(e)},function(e){n(e)})},a["delete"]=function(t,a,n){e["delete"]({id:t._id},function(e){a(e)},function(e){n(e)})}}]),app.service("TracksSvc",["Tracks","$log","UsersSvc","AlbumsSvc","$window","sessionStore",function(e,t,a,n,r,i){var o=this;o.create=function(t,a,n){var r=new e({about:t.about,albumId:t.album._id,artistId:t.artist._id,audioFile:t.audioFile,coverArt:t.coverArt,downloadable:t.downloadable,duration:t.duration,feat:t.feat,genre:t.genre,imageFile:t.imageFile,lyrics:t.lyrics,releaseDate:t.releaseDate,streamUrl:t.streamUrl,title:t.title});r.$save(function(e){a(e)},function(e){n(e)})},o.update=function(t,a,n){e.get({id:t._id},function(e){for(var r in e)t[r]&&e[r]!==t[r]&&(e[r]=t[r]);e.albumId=t.album._id,e.artistId=t.artist._id,"imageFile"in t&&t.imageFile&&(e.imageFile=t.imageFile),"audioFile"in t&&t.audioFile&&(e.audioFile=t.audioFile),e.$update(function(e){a(e)},function(e){n(e)})})},o.get=function(t,a,n){e.get({id:t},function(e){e.releaseDate=new Date(e.releaseDate),e.img="/assets/tracks/"+e._id+"/tof",e.url="/assets/tracks/"+e._id+"/zik",a(e)},function(e){n(e)})},o.latest=function(t,a){e.query(function(e){var a=[];angular.forEach(e,function(e){e.releaseDate=new Date(e.releaseDate),e.img="/assets/tracks/"+e._id+"/tof",e.url="/assets/tracks/"+e._id+"/zik",this.push(e)},a),t(a)},function(e){a("Could query all the tracks!")})},o.find=function(t,a,n){var r;("a_id"in t||"u_id"in t)&&(r=t.a_id?{resource:"album",resource_id:t.a_id}:{resource:"artist",resource_id:params.u_id}),r?e.find(r,function(e){angular.forEach(e,function(e){e.releaseDate=new Date(e.releaseDate),e.img="/assets/tracks/"+e._id+"/tof",e.url="/assets/tracks/"+e._id+"/zik"}),a(e)},function(e){n(e)}):n("invalid find params")},o.downloadLink=function(e,t,a){var n=i.getData("accessKeys"),o=n?n.access_token:null,s="/zinfataclient/tracks/"+e._id+"/download";o&&(s+="?token="+o,r.open(s))},o["delete"]=function(t,a,n){e["delete"]({id:t._id},function(e){e.releaseDate=new Date(e.releaseDate),a(e)},function(e){n(e)})}}]),app.service("PlaylistsSvc",["Playlists","$log",function(e,t){var a=this;a.create=function(t,a,n){var r=new e({ownerId:t.owner.id,title:t.title,tracks:t.tracks});r.$save(function(e){return a(e)},function(e){return n(e)})},a.update=function(t,a,n){e.get({id:t._id},function(e){for(var r in e)t[r]&&e[r]!==t[r]&&(e[r]=t[r]);e.$update(function(e){return a(e)},function(e){return n(e)})})},a.get=function(t,a,n){return e.get({id:t},function(e){e.owner={id:e.ownerId},delete e.ownerId,a(e)},function(e){n(e)})},a.all=e.query(function(e){var t=[];return angular.forEach(e,function(e){e.owner={id:e.ownerId},delete e.ownerId,this.push(e)},t),t},function(e){t.debug("Unable to get all the playlists!")}),a.find=function(t,a,n){"u_id"in t&&(t.resource="owner",t.resource_id=t.u_id,delete t.u_id,e.find(t,function(e){angular.forEach(e,function(e){e.owner={id:e.ownerId},delete e.ownerId}),a(e)},function(e){n(e)}))},a["delete"]=function(t,a,n){e["delete"]({id:t._id},function(e){e.owner={id:e.ownerId},delete e.ownerId,a(e)},function(e){n(e)})},a.addTrack=function(t,a,n,r){e.get({id:t._id},function(e){e.tracks.push(a._id),e.$update(function(e){n(e)},function(e){r(!1)})},function(e){r(!1)})},a.removeTrack=function(t,a,n,r){e.get({id:t._id},function(e){e.tracks.splice(a,1),e.$update(function(e){n(e)},function(e){r(!1)})},function(e){r(!1)})}}]),app.service("QueueSvc",["localStore","$rootScope","AUDIO","QUEUE","$log","TracksSvc","SessionSvc","AUTH",function(e,t,a,n,r,i,o,s){function c(e,t){var a=d();a.push(e._id),y(a)}function u(){return e.getData(p()+".queue.nowPlaying")||{}}function l(e,t){var a=d();a.length?i.get(a[e],t):t("No tracks to fetch")}function d(){return e.getData(p()+".queue.tracks")||[]}function f(e){return d().length<=1?void r.error("There isn't any next track to load!"):void l(e,function(e){y(null,e),t.$broadcast(a.load,e)})}function g(){return d().length<=1?void r.error("There isn't any next track to play!"):void l(1,function(e){h(e,1)})}function p(){return o.getCurrentUser()&&o.getCurrentUser()._id}function m(e){y(null,e),t.$broadcast(a.playNow,e)}function h(e,t){var a;t&&k(t,function(e){return e?void 0:(r.error("Failed to remove track at %s",t),!1)}),a=d(),a.unshift(e._id),y(a),k(1,function(t){return t?void m(e):(r.error("Failed to remove next track inline"),!1)})}function v(){if(d().length<=1)return void r.error("There isn't any previous track to play!");var e=d().length-1;l(e,function(t){h(t,e)})}function k(e,t){var a,n=d();a=n.splice(e,1),a.length||t(!1),y(n),t(a[0])}function y(t,a){t&&Array.isArray(t)&&e.setData(p()+".queue.tracks",t),a&&e.setData(p()+".queue.nowPlaying",a)}var b=this;b.addTrack=c,b.getCurrentTrack=u,b.getTrackAt=l,b.getTracks=d,b.load=f,b.playNext=g,b.playNow=h,b.playPrev=v,b.removeTrackAt=k}]),app.service("MessageSvc",function(){this.message=null,this.getMsg=function(){return this.message},this.addMsg=function(e,t){this.message={type:e,text:t}},this.clear=function(){this.message=null}}),app.controller("albumCtrl",["$scope","$rootScope","$location","$routeParams","SessionSvc","TracksSvc","QueueSvc","AlbumsSvc","UsersSvc","MessageSvc","ALBUM_EVENTS","$log",function(e,t,a,n,r,i,o,s,c,u,l,d){e.album={coverArt:"",imageUrl:"images/album-coverart-placeholder.png",title:"",artist:{id:""},about:"",releaseDate:""},e.album.img=e.album.imageUrl,e.editing=!1,e.creating=!1,e.canEdit=!1,e.pageTitle="Add New Album",e.pageDescription="Quickly upload a new album to Zinfata.";var f="/assets/albums/"+n.albumId+"/tof";"/album/new"===a.path()&&(e.creating=!0),n.albumId&&s.get(n.albumId,function(t){e.album=t,e.album.duration=0,e.album.trackLength=0,e.album.img=f;var o=0;e.album.artist.id&&e.album.artist.id===r.getCurrentUser()._id&&(e.canEdit=!0),a.path()==="/album/"+n.albumId+"/edit"&&(e.canEdit?e.editing=!0:a.path("album/"+n.albumId),e.editing&&(e.pageTitle="Edit Album Info",e.pageDescription="Edit this album basic information.")),c.get(e.album.artist.id,function(t){e.album.artist.handle=t.handle,e.album.artist.avatarUrl=t.avatarUrl,e.album.artist.img="/assets/users/"+t._id+"/tof"},function(t){e.album.artist="Unknown"}),i.find({a_id:t._id},function(t){angular.forEach(t,function(t){e.album.trackLength++,o=parseInt(t.duration),angular.isNumber(o)&&(e.album.duration+=o)})},function(e){})},function(e){a.path("/")}),e.edit=function(e){a.path("/album/"+e._id+"/edit")},e.queueUp=function(e){},e.play=function(e){},e.create=function(e){e.artist.id||(e.artist.id=r.getCurrentUser()._id),s.create(e,function(e){t.$broadcast(l.createSuccess),u.addMsg("success","You have successfully added a new album!"),a.path("album/"+e._id)},function(e){t.$broadcast(l.createFailed),u.addMsg("danger","Something went wrong trying to create your album!")})},e.update=function(n){e.album.duration&&delete e.album.duration,e.album.trackLength&&delete e.album.trackLength,n.artist.id||(n.artist.id=r.getCurrentUser()._id),s.update(n,function(n){t.$broadcast(l.updateSuccess),u.addMsg("success","You have successfully updated the album info"),e.editing=!1,a.path("album/"+n._id)},function(e){t.$broadcast(l.updateFailed),u.addMsg("danger","Something went wrong trying to update your album!")})},e["delete"]=function(e){s["delete"](e,function(){u.addMsg("success","The album has been successfully deleted!"),t.$broadcast(l.deleteSuccess),a.path("/user/"+e.artist.id)},function(e){u.addMsg("danger","A problem prevented the deletion of your album. Try again later"),t.$broadcast(l.deleteFailed)})},e.updateCoverImage=function(t){e.album.coverArt=t.file,e.album.img=t.url}}]),app.controller("dashboardCtrl",["$scope","TracksSvc","SessionSvc","$log","QueueSvc",function(e,t,a,n,r){e.tracks=[],e.loggedIn=function(){return!!a.getCurrentUser()},t.latest(function(t){var a=[],n=0;angular.forEach(t,function(e){e.id=n++,e.img="/assets/tracks/"+e._id+"/tof",e.url="/assets/tracks/"+e._id+"/zik",a.push(e)}),e.tracks=a},function(e){n.error(e)}),e.play=function(e){r.playNow(e)},e.addToQueue=function(e){r.addTrack(e)}}]),app.controller("forgotCtrl",["$scope","$rootScope","$location","MessageSvc","Users","PWD_TOKEN",function(e,t,a,n,r,i){e.email="",e.reset=function(a){r.resetPassword({email:a},function(a){t.$broadcast("PWD_TOKEN.sendSuccess"),n.addMsg("success","An email has been sent to you withinstructions on how to reset your password"),e.email=""},function(e){t.$broadcast("PWD_TOKEN.sendFailed"),n.addMsg("danger","Something went wrong when trying toverify your email. Try again later!")})}}]),app.controller("logoutCtrl",["$rootScope","$log","MessageSvc","UsersSvc","AUTH",function(e,t,a,n,r){Auth.logout(function(){n.setCurrentUser({}),e.$broadcast(r.logoutSuccess),a.addMsg("success","You have been successfully logged out!")},function(e){a.addMsg("danger","We couldn't log you out. Try again later!")})}]),app.controller("loginCtrl",["$scope","$rootScope","AUTH","AuthenticationSvc","MessageSvc","$location","$log",function(e,t,a,n,r,i,o){e.credentials={handle:"",password:""},e.authenticate=function(t){n.login(t,function(t){r.addMsg("success","You are now logged in as "+t.handle),e.credentials={},e.loginForm.$setPristine(),i.path("dashboard")},function(e){var t;"mustActivateAccount"===e?(t="You must activate your account to access all the music.Check the email we sent you for the activation link.Or enter your email address below to have us send you a new validation link.",i.path("register/activate")):(t="Login failed! Try again later.",i.path("login")),r.addMsg("danger",t)})}}]),app.controller("passwordResetCtrl",["$scope","$log","$rootScope","UsersSvc","Users","$location","MessageSvc","USER_EVENTS","PWD_TOKEN","$routeParams",function(e,t,a,n,r,i,o,s,c,u){e.credentials={password:"",passwordConfirmation:"",token:""},e.validated=!1,e.verify=function(t){r.verifyToken({token:t},function(t){a.$broadcast(c.verificationSuccess),e.validated=!0},function(e){a.$broadcast(c.verificationFailed),o.addMsg("danger","The verification token is either invalid or expired. Request a new one!")})},e.update=function(e){e.token&&e.password===e.passwordConfirmation&&r.verifyToken({token:e.token,get_user:!0},function(r){n.update({password:e.password,_id:r.userId},function(e){t.debug(angular.toJson(e)),a.$broadcast(s.updateSuccess),o.addMsg("success","Password successfully updated. Log in now"),i.path("login")},function(e){a.$broadcast(s.updateFailed),o.addMsg("danger","Something went wrong when trying to update your password!")})})},u.token&&(e.credentials.token=u.token,e.verify(e.credentials.token))}]),app.controller("playlistCtrl",["$scope","$rootScope","$location","$log","$routeParams","AlbumsSvc","TracksSvc","UsersSvc","SessionSvc","PlaylistsSvc","MessageSvc","QueueSvc","PLAYLIST_EVENTS",function(e,t,a,n,r,i,o,s,c,u,l,d,f){
e.playlist={title:"",owner:{id:"",handle:""},tracks:[]},e.playlistTracks=[],e.canEdit=!1,e.creating=!1,e.editing=!1,e.pageTitle="Add New Playlist",e.pageDescription="Find and share your favorite tracks easily.","/playlist/new"===a.path()&&(e.creating=!0),r.playlistId&&u.get(r.playlistId,function(t){if(t.duration=0,t.owner.id&&t.owner.id===c.getCurrentUser()._id&&(e.canEdit=!0),a.path()==="/playlist/"+r.playlistId+"/edit"&&(e.canEdit?e.editing=!0:a.path("/playlist/"+r.playlistId),e.editing&&(e.pageDescription="Change this playlist's information",e.pageTitle="Update Playlist")),s.get(t.owner.id,function(e){t.owner.handle=e.handle},function(e){n.error("Error getting playlist owner info: "+e)}),t.tracks.length){var i=0;angular.forEach(t.tracks,function(a,n){"string"==typeof a&&o.inflate(a,e.playlistTracks,function(e){i=parseInt(e.duration),angular.isNumber(i)||(i=0),t.duration+=i},function(e){})})}e.playlist=t},function(e){a.path("/")}),e.edit=function(){a.path("/playlist/"+e.playlist._id+"/edit")},e.removeTrack=function(a){u.removeTrack(e.playlist,a,function(t){e.playlistTracks.splice(a,1)},function(e){t.$broadcast(f.updateFailed)})},e.play=function(e){d.playNow(e)},e.addToQueue=function(e){d.addTrack(e)},e.create=function(e){e.owner.id=c.getCurrentUser()._id,u.create(e,function(e){t.$broadcast(f.createSuccess),l.addMsg("success","You have successfully added a new playlist!"),a.path("playlist/"+e._id)},function(e){t.$broadcast(f.createFailed),l.addMsg("danger","Something went wrong trying to add your new playlist!")})},e.update=function(e){u.update(e,function(e){t.$broadcast(f.updateSuccess),l.addMsg("success","You have successfully updated this playlist!"),a.path("playlist/"+e._id)},function(e){t.$broadcast(f.updateFailed),l.addMsg("danger","Something went wrong trying to update your playlist!")})},e["delete"]=function(e){u["delete"](e,function(e){t.$broadcast(f.deleteSuccess),l.addMsg("success","You have successfully deleted the playlist!"),a.path("/")},function(e){t.$broadcast(f.deleteFailed),l.addMsg("danger","Something went wrong trying to delete your playlist!")})}}]),app.controller("queueCtrl",["$scope","$rootScope","$log","QueueSvc","TracksSvc","AUDIO",function(e,t,a,n,r,i){function o(t){e.queue.duration+=t}function s(e,t){if(0===e){var a=soundManager.getSoundById("sound_"+t);return a&&(!a||a.playState)}return!1}function c(a,r){a.preventDefault(),0===r?t.$broadcast(i.playPause):n.playNow(e.queue.tracks[r],r)}function u(t){return n.getTracks().length<=1&&0===t?void a.error("This track is the currently loaded"):void n.removeTrackAt(t,function(r){var i,o;return r?(i=e.queue.tracks.splice(t,1),i.length?(0===t&&(o=n.load(0)),void f()):void a.error("QueueController: couldn't splice out item at: %s",t)):void a.error("QueueSvc: couldn't remove track at: %s",t)})}function l(){e.queue.tracks=[],e.queue.duration=0}function d(){l();var t=n.getTracks();e.queue.tracks=[],t.length&&angular.forEach(t,function(e,t){var a=this;"string"==typeof e&&r.get(e,function(e){o(e.duration),a[t]=e},function(e){})},e.queue.tracks)}function f(){e.queue.duration=0,angular.forEach(e.queue.tracks,function(e){o(e.duration)})}e.musicPlaying=s,e.queue={duration:0,tracks:[],playPause:c,removeTrack:u},e.$on(i.playNow,function(e,t){d()}),e.$on(i.load,function(e,t){d()}),d()}]),app.controller("registerCtrl",["$scope","UsersSvc","MessageSvc","$location",function(e,t,a,n){e.user={firstName:"",lastName:"",handle:"",email:"",password:""},e.register=function(){t.create(e.user,function(t){a.addMsg("success","Welcome to Zinfata, "+t.firstName+". Check the email we sent you to activate your account"),e.user={},e.registerForm.$setPristine()},function(e){a.addMsg("danger","Oops, we were unable to register you!")})}}]),app.controller("searchCtrl",["$routeParams",function(e){"q"in e&&(scope.searchTerm=e.q)}]),app.controller("tokenCtrl",["$scope","$rootScope","$routeParams","$location","Users","MessageSvc","PWD_TOKEN","USER_EVENTS",function(e,t,a,n,r,i,o,s){var c=a.token;e.email="",c&&r.verifyToken({token:c},function(e){t.$broadcast(s.accountActivated),i.addMsg("success","Account successfully activated. Log in now to access all the music!"),n.path("login")},function(e){t.$broadcast(o.verificationFailed),i.addMsg("danger","That activation link is no longer valid. Please, request a new one!")}),e.activate=function(e){r.activate({email:e},function(e){t.$broadcast(o.sendSuccess),i.addMsg("success","Great. We just sent you a new email with the link to activate your account!")},function(e){t.$broadcast(o.sendFailed),i.addMsg("danger","We couldn't send you a new email at the moment. Try again later.")})}}]),app.controller("trackCtrl",["$scope","$sce","$rootScope","$location","$routeParams","$log","UsersSvc","SessionSvc","TracksSvc","PlaylistsSvc","TRACK_EVENTS","AlbumsSvc","ALBUM_EVENTS","MessageSvc","QueueSvc",function(e,t,a,n,r,i,o,s,c,u,l,d,f,g,p){var m="images/track-coverart-placeholder.png",h={},v=function(t){d.getByUser({_id:t},function(t){t.length&&(e.track.album._id||(e.track.album.title=t[0].title,e.track.album.releaseDate=t[0].releaseDate,e.track.album._id=t[0]._id),angular.forEach(t,function(t){h[t._id]=t.releaseDate,t._id===e.track.album._id&&(e.track.album.title=t.title,e.track.album.releaseDate=t.releaseDate)}),e.albums=t)},function(t){i.error("Error fetching albums for artist: "+e.track.artist._id)})};e.musicGenres=["alternative","blues","danse","hip hop","rap","r&b","soul","jazz","gospel","reggae","rock","dubstep","trap","instrumental","salsa","flamenco","reggaeton","meditation","funk","dancehall","a cappella","afro-beat","calypso","coupe-decale","worldbeat"],e.track={title:"",about:"",lyrics:"",album:{_id:null,title:"",coverArt:""},artist:{_id:null,handle:""},streamUrl:"",coverArt:"images/track-coverart-placeholder.png",duration:"",releaseDate:"",genre:"",downloadable:!1},e.cover={useAlbum:!1},e.albums=[],e.creating=e.editing=!1,e.pageTitle="Add New Track",e.pageDescription="Upload a new song for the world to enjoy.",e.track.img=e.track.coverArt,"/track/new"===n.path()&&(e.creating=!0),r.trackId&&c.get(r.trackId,function(t){e.track=t,e.track.img="/assets/tracks/"+e.track._id+"/tof",e.track.album.img="/assets/albums/"+e.track.album._id+"/tof",e.track.artist._id&&e.track.artist._id===s.getCurrentUser()._id&&(e.canEdit=!0),n.path()==="/track/"+r.trackId+"/edit"&&(e.canEdit?e.editing=!0:n.path("track/"+r.trackId),e.editing&&(e.pageDescription="Edit this track's information",e.pageTitle="Edit Track Information")),v(e.track.artist._id),o.get(e.track.artist._id,function(t){e.track.artist.handle=t.handle},function(t){i.error("could not fetch track artist: "+e.track.artist._id)})},function(e){n.path("/")}),e.creating&&v(s.getCurrentUser()._id),e.$watch(function(){return e.track.album._id},function(t,a){t!==a&&(e.cover.useAlbum&&(e.track.img="/assets/albums/"+t+"/tof"),e.track.album.releaseDate=h[t],(!e.track.releaseDate||e.track.album.releaseDate<e.track.releaseDate)&&(e.track.releaseDate=e.track.album.releaseDate))}),e.$watch(function(){return e.track.streamUrl},function(t,a){var n=new Audio(t);n.onloadedmetadata=function(){e.track.duration=n.duration}}),e.$watch(function(){return e.track.coverArt},function(t,a){t&&-1!==t.search("album-coverart-placeholder")&&(e.track.coverArt=t.replace("album","track"))}),e.$on(f.createSuccess,function(t,a){e.albums.push(a),e.track.album._id||(h[a._id]=new Date(a.releaseDate),e.track.album._id=a._id,e.track.album.title=a.title)}),e.readFile=function(a){var n=a.files[0],r=new FileReader;r.onload=function(){e.$apply(function(){"music"===a.name&&(e.track.audioFile=n,e.track.streamUrl=t.trustAsResourceUrl(r.result))})},r.readAsDataURL(n)},e.getFile=function(t){e.track.audioFile=t.files[0]},e.addToPlaylist=function(t){u.addTrack(t,e.track)},e.play=function(e){p.playNow(e)},e.addToQueue=function(e){p.addTrack(e)},e.create=function(e){e.artist._id=s.getCurrentUser()._id,delete e.streamUrl,c.create(e,function(e){a.$broadcast(l.createSuccess,e),g.addMsg("success","You have successfully added a new track!"),n.path("track/"+e._id)},function(e){a.$broadcast(l.createFailed,e),g.addMsg("danger","Something went wrong trying to upload your new track!")})},e.update=function(e){delete e.streamUrl,c.update(e,function(e){a.$broadcast(l.updateSuccess,e),g.addMsg("success","You have successfully updated this track!"),n.path("track/"+e._id)},function(e){a.$broadcast(l.updateFailed,e),g.addMsg("danger","Something went wrong trying to update your track's info!")})},e["delete"]=function(e){c["delete"](e,function(e){a.$broadcast(l.deleteSuccess),g.addMsg("success","You have successfully deleted the track!"),n.path("/album/"+e.album.id)},function(e){a.$broadcast(l.deleteFailed),g.addMsg("danger","Something went wrong trying to delete your track!")})},e.updateCoverArt=function(t){t?e.track.img=m:e.track.img="/assets/albums/"+e.track.album._id+"/tof"},e.updateCoverImage=function(t){e.track.imageFile=t.file,e.track.coverArt=m=t.url,e.track.img=t.url},e.download=function(e){c.downloadLink(e,function(e){a.$broadcast(l.downloadSuccess)},function(){a.$broadcast(l.downloadFailed),g.addMsg("danger","Download failed!")})},e.edit=function(){n.path("/track/"+e.track._id+"/edit")}}]),app.controller("userProfileCtrl",["$scope","$rootScope","UsersSvc","AlbumsSvc","MessageSvc","USER_EVENTS","$routeParams","$log","$location","SessionSvc",function(e,t,a,n,r,i,o,s,c,u){var l=o.userId||u.getCurrentUser()&&Sesion.getCurrentUser()._id||null;e.fbRegex=/(?:https?:\/\/)?(?:www\.)?facebook\.com\/(?:(?:\w)*#!\/)?(?:pages\/)?(?:[\w\-]*\/)*([\w\-]*)/,e.user={},e.editing=!1,e.canEdit=!1,a.get(l,function(t){e.user=t,e.user.img="/assets/users/"+l+"/tof",u.getCurrentUser()._id===e.user._id&&(e.canEdit=!0),c.path()==="/user/"+l+"/edit"&&e.canEdit&&(e.editing=!0)},function(e){c.path("/")}),e.fullname=function(e){return e.firstName+" "+e.lastName},e.edit=function(){c.path("/user/"+e.user._id+"/edit")},e.update=function(n){a.update(n,function(a){r.addMsg("success","Your profile has been updated!"),t.$broadcast(i.updateSuccess),e.editing=!1,c.path("/user/"+e.user._id)},function(e){r.addMsg("danger","Profile update unsuccessful!"),t.$broadcast(i.updateFailed)})},e["delete"]=function(e){a["delete"](e,function(e){r.addMsg("success","Your account has been deleted!"),t.$broadcast(i.deleteSuccess,e)},function(e){r.addMsg("danger","A problem prevented your account deletion. Try again later"),t.$broadcast(i.deleteFailed)})},e.updateAvatar=function(t){e.user.avatar=t.file,e.user.img=t.url}}]),app.controller("headerCtrl",["$scope","$rootScope","AUTH","SessionSvc","MessageSvc","AuthenticationSvc","$location","$log","USER_EVENTS",function(e,t,a,n,r,i,o,s,c){function u(){e.loggedIn&&(e.user=n.getCurrentUser())}e.loggedIn=i.isAuthenticated,e.user=n.getCurrentUser(),e.$watch(function(){return i.isAuthenticated()},function(e,t){e!==t&&u()}),e.$on(c.deleteSuccess,function(){e.logout()}),e.userProfile=function(e){var t="#";return e&&"_id"in e&&e._id&&(t="user/"+e._id),t},e.userSettings=function(e){return"#"},e.logout=function(){i.logout(function(e){e?(r.addMsg("success","You have been successfully logged out!"),t.$broadcast(a.logoutSuccess)):(r.addMsg("danger","Issue with the logout process!"),n.destroy(),t.$broadcast(a.logoutFailed)),o.path("/login")})}}]),app.controller("messageCtrl",["$scope","MessageSvc","$log","$timeout",function(e,t,a,n){var r=angular.element(".alert-dismissable");e.icon=function(){return"success"===e.message().type?"fa fa-check":"fa fa-exclamation"},e.$watch(function(){return t.getMsg()},function(t,a){r.show(),e.message=t,e.icon=e.message&&"success"===e.message.type?"fa fa-check":"fa fa-exclamation",n(function(){r.alert("close")},3e3)}),r.on("close.bs.alert",function(){return r.hide(),!1})}]),app.controller("playerCtrl",["$scope","$rootScope",function(e,t){e.track={},e.$on("AUDIO.playNow",function(e){})}]),app.controller("sidebarCtrl",["$scope","$log","AuthenticationSvc","PlaylistsSvc","SessionSvc","AUTH",function(e,t,a,n,r,i){r.getCurrentUser();e.isloggedIn=a.isAuthenticated}]);